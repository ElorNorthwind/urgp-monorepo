-- Замы
DROP TABLE IF EXISTS vks.zams CASCADE;
CREATE TABLE vks.zams
(
    id INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    title TEXT,
    surname VARCHAR(255),
    first_name VARCHAR(255),
    last_name VARCHAR(255),
    full_name text GENERATED ALWAYS AS (
       COALESCE(title || ' ', '') || COALESCE(surname, '') || COALESCE(' ' || first_name, '') || COALESCE( ' ' || last_name, '')
    ) STORED,
    short_name text GENERATED ALWAYS AS (
        COALESCE(surname || ' ', '') || COALESCE(LEFT(first_name, 1) || '.', '') || COALESCE(LEFT(last_name, 1) || '.', '')
    ) STORED,

    PRIMARY KEY (id)
);
ALTER TABLE vks.zams
    OWNER to renovation_user;

INSERT INTO vks.zams (id, title, surname, first_name, last_name) VALUES
    (1, 'Заместитель руководителя', 'Биктимиров', 'Руслан', 'Гумерович'),
    (2, 'Заместитель руководителя', 'Гдлян', 'Анджела', 'Тельмановна'),
    (3, 'Первый заместитель руководителя', 'Пушкарь', 'Яна', 'Анатольевна'),
    (4, 'Заместитель руководителя', 'Никифор', 'Андрей', 'Сергеевич'),
    (5, 'Первый заместитель руководителя', 'Спесивцева', 'Елена', 'Юрьевна');


-- Управления
DROP TABLE IF EXISTS vks.departments CASCADE;
CREATE TABLE vks.departments
(
    id INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    full_name TEXT,
    short_name VARCHAR(255),
    boss_surname VARCHAR(255),
    boss_first_name VARCHAR(255),
    boss_last_name VARCHAR(255),
    zam_id INTEGER REFERENCES vks.zams(id) ON DELETE SET NULL,
    display_name text GENERATED ALWAYS AS (
       COALESCE(short_name || ' (', '') || COALESCE(boss_surname, '') || COALESCE(' ' || LEFT(boss_first_name, 1) || '.', '') || COALESCE( ' ' || LEFT(boss_last_name, 1) || '.', '') || ')'
    ) STORED,

    PRIMARY KEY (id)
);
ALTER TABLE vks.departments
    OWNER to renovation_user;

INSERT INTO vks.departments (id, full_name, short_name, boss_surname, boss_first_name, boss_last_name, zam_id) VALUES
    (1, 'Управление реализации жилищных программ', 'УРЖП', 'Лукьянов', 'Михаил', 'Георгиевич',1),
    (2, 'Управления оформления жилищных правоотношений', 'УОЖП', 'Пахмутов', 'Сергей', 'Анатольевич',1),
    (3, 'Управление правового обеспечения в жилищной сфере', 'УПОЖС', 'Спесивцева', 'Светлана', 'Владиславовна',2),
    (4, 'Управление оформления вторичных имущественно-земельных отношений', 'УОВИЗО', 'Смирнова', 'Светлана', 'Викторовна',3),
    (5, 'Управление по реализации градостроительной политики и транспортной инфраструктуры', 'УРГПТИ', 'Лапковская', 'Екатерина', 'Викторовна',4),
    (6, 'Управление приватизации городского имущества', 'УПГИ', 'Файнгерш', 'Сергей', 'Игоревич',3),
    (7, 'Управление по формированию земельных участков', 'УФЗУ', 'Воронков', 'Игорь', 'Владимирович',2),
    (8, 'Управления обеспечения кадастрового учета и регистрации прав', 'УОКУРП', 'Стифеева', 'Анна', 'Сергеевна',5),
    (9, 'Управления оформления имущественных и земельно-правовых отношений', 'УОИЗПО', 'Мартьянов', 'Сергей', 'Валерьевич',2),
    (10, 'Управление экономики', 'УЭ', 'Мишин', 'Иван', 'Викторович',5),
    (11, 'Управление городским имуществом в Cеверо-Восточном административном округе', 'УГИ СВАО', 'Ильина', 'Лариса', 'Владимировна',3),
    (12, 'Управление городским имуществом в Юго-Западном административном округе', 'УГИ ЮЗАО', 'Заикина', 'Ольга', 'Викторовна',3);

-- Сервисы
DROP TABLE IF EXISTS vks.services CASCADE;
CREATE TABLE vks.services
(

    id INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    full_name TEXT,
    short_name VARCHAR(255),
    property_type VARCHAR(255),
    mailbox VARCHAR(255),
    responsible_email VARCHAR(255),
    responsible_name VARCHAR(255),
    department_id INTEGER REFERENCES vks.departments(id) ON DELETE SET NULL,
    PRIMARY KEY (id)
);
ALTER TABLE vks.services
    OWNER to renovation_user;

INSERT INTO vks.services (id, full_name, short_name, property_type, mailbox, responsible_email, responsible_name, department_id) VALUES
    (416, 'Онлайн-консультация по жилищным вопросам: Договоры социального найма (безвозмездного пользования) - заключение, внесение изменений.', 'ГУ ДСП', 'Жилищные вопросы', 'dgi-consult12@mos.ru', 'NaumovOV1@mos.ru', 'Наумов О.В.',1),
    (417, 'Онлайн-консультация по жилищным вопросам: Приватизация/деприватизация жилых помещений', 'Приватизация', 'Жилищные вопросы', 'dgi-consult12@mos.ru', 'NaumovOV1@mos.ru', 'Наумов О.В.',1),
    (418, 'Онлайн-консультация по вопросу: «Получение справочной информации по обжалованию отказов в предоставлении государственных услуг в жилищной сфере в соответствии с Постановлением Правительства Москвы от 10.09.2014 № 521-ПП»', 'Отказы ГУ', 'Жилищные вопросы', 'dgi-consult8@mos.ru', 'PolyarushDB@mos.ru', 'Поляруш Д.Б.',2),
    (422, 'Онлайн-консультация по вопросу: «Судебные споры с Департаментом городского имущества города Москвы по жилищным вопросам в судах общей юрисдикции»', 'Суды с ДГИ', 'Жилищные вопросы', 'dgi-consult7@mos.ru', 'Ortega-khilMI@mos.ru', 'Ортега-Хиль М.И.',3),
    (1057, 'Онлайн-консультация по вопросу: «Согласие на совершение сделок в отношении права аренды земельного участка и арендованного нежилого помещения»', 'Согласование аренды', 'Земельные и нежилые имущественные вопросы', 'dgi-consult2@mos.ru', 'PostolakiVV@mos.ru', 'Постолаки В.В.',4),
    (1058, 'Онлайн-консультация по вопросу: «Согласие на совершение сделок в отношении права аренды земельного участка и арендованного нежилого помещения»', 'Согласование аренды', 'Земельные и нежилые имущественные вопросы', 'dgi-consult2@mos.ru', 'PostolakiVV@mos.ru', 'Постолаки В.В.',4),
    (1059, 'Онлайн-консультация по вопросу: «Согласие на совершение сделок в отношении права аренды земельного участка и арендованного нежилого помещения»', 'Согласование аренды', 'Земельные и нежилые имущественные вопросы', 'dgi-consult2@mos.ru', 'PostolakiVV@mos.ru', 'Постолаки В.В.',4),
    (1060, 'Онлайн-консультация по вопросу: «Межевание кварталов»', 'Межевание кварталов', 'Земельные и нежилые имущественные вопросы', 'dgi-consult4@mos.ru', 'NetkachevaVV@mos.ru', 'Неткачева В.В.',5),
    (1061, 'Онлайн-консультация по вопросу: «Межевание кварталов»', 'Межевание кварталов', 'Земельные и нежилые имущественные вопросы', 'dgi-consult4@mos.ru', 'NetkachevaVV@mos.ru', 'Неткачева В.В.',5),
    (1062, 'Онлайн-консультация по вопросу: «Межевание кварталов»', 'Межевание кварталов', 'Земельные и нежилые имущественные вопросы', 'dgi-consult4@mos.ru', 'NetkachevaVV@mos.ru', 'Неткачева В.В.',5),
    (1063, 'Онлайн-консультация по вопросу: «Преимущественное право выкупа субъектами малого и среднего предпринимательства арендуемого недвижимого имущества в соответствии с Федеральным законом от 22.07.2008 №159-ФЗ»', 'Выкуп аренды', 'Земельные и нежилые имущественные вопросы', 'dgi-consult5@mos.ru', 'ShevtsovaTA@mos.ru', 'Шевцова Т.А.',6),
    (1064, 'Онлайн-консультация по вопросу: «Преимущественное право выкупа субъектами малого и среднего предпринимательства арендуемого недвижимого имущества в соответствии с Федеральным законом от 22.07.2008 №159-ФЗ»', 'Выкуп аренды', 'Земельные и нежилые имущественные вопросы', 'dgi-consult5@mos.ru', 'ShevtsovaTA@mos.ru', 'Шевцова Т.А.',6),
    (1065, 'Онлайн-консультация по вопросам: «Предварительное согласование предоставления земельного участка», «Перераспределение земель и (или) земельных участков, находящихся в государственной или муниципальной собственности, и земельных участков, находящихся в частной собственности», «Изменение разрешенного использования земельного участка»', 'Сделки с землёй', 'Земельные и нежилые имущественные вопросы', 'dgi-consult1@mos.ru', 'SemenovaER@mos.ru', 'Семенова Э.Р.',7),
    (1066, 'Онлайн-консультация по вопросам: «Предварительное согласование предоставления земельного участка», «Перераспределение земель и (или) земельных участков, находящихся в государственной или муниципальной собственности, и земельных участков, находящихся в частной собственности», «Изменение разрешенного использования земельного участка»', 'Сделки с землёй', 'Земельные и нежилые имущественные вопросы', 'dgi-consult1@mos.ru', 'SemenovaER@mos.ru', 'Семенова Э.Р.',7),
    (1067, 'Онлайн-консультация по вопросам: «Предварительное согласование предоставления земельного участка», «Перераспределение земель и (или) земельных участков, находящихся в государственной или муниципальной собственности, и земельных участков, находящихся в частной собственности», «Изменение разрешенного использования земельного участка»', 'Сделки с землёй', 'Земельные и нежилые имущественные вопросы', 'dgi-consult1@mos.ru', 'SemenovaER@mos.ru', 'Семенова Э.Р.',7),
    (1068, 'Онлайн-консультация по вопросу: «Регистрация прав на земельные участки, находящиеся в собственности города Москвы»', 'Регистрация прав на землю', 'Земельные и нежилые имущественные вопросы', 'dgi-consult3@mos.ru', 'ProkhorovVD@mos.ru', 'Прохоров В.Д.',8),
    (1069, 'Онлайн-консультация по вопросу: «Регистрация прав на земельные участки, находящиеся в собственности города Москвы»', 'Регистрация прав на землю', 'Земельные и нежилые имущественные вопросы', 'dgi-consult3@mos.ru', 'ProkhorovVD@mos.ru', 'Прохоров В.Д.',8),
    (1071, 'Онлайн-консультация по вопросам: «Выдача разрешения на использование земель или земельных участков, находящихся в собственности города Москвы, земель или земельных участков, государственная собственность на которые не разграничена», «Выдача договора на размещение объекта благоустройства (элементов благоустройства территории)», «Предоставление земельного участка в аренду правообладателям зданий, сооружений, расположенных на земельном участке»', 'Аренда земли', 'Земельные и нежилые имущественные вопросы', 'dgi-consult6@mos.ru', 'KuzminaTY@mos.ru', 'Кузьмина Т.Ю.',9),
    (1072, 'Онлайн-консультация по вопросам: «Выдача разрешения на использование земель или земельных участков, находящихся в собственности города Москвы, земель или земельных участков, государственная собственность на которые не разграничена», «Выдача договора на размещение объекта благоустройства (элементов благоустройства территории)», «Предоставление земельного участка в аренду правообладателям зданий, сооружений, расположенных на земельном участке»', 'Аренда земли', 'Земельные и нежилые имущественные вопросы', 'dgi-consult6@mos.ru', 'KuzminaTY@mos.ru', 'Кузьмина Т.Ю.',9),
    (1073, 'Онлайн-консультация по вопросам: «Выдача разрешения на использование земель или земельных участков, находящихся в собственности города Москвы, земель или земельных участков, государственная собственность на которые не разграничена», «Выдача договора на размещение объекта благоустройства (элементов благоустройства территории)», «Предоставление земельного участка в аренду правообладателям зданий, сооружений, расположенных на земельном участке»', 'Аренда земли', 'Земельные и нежилые имущественные вопросы', 'dgi-consult6@mos.ru', 'KuzminaTY@mos.ru', 'Кузьмина Т.Ю.',9),
    (1075, 'Онлайн-консультация по вопросам: «Внесение изменений в договор аренды на нежилое помещение,расторжение договора аренды», «Получение согласия Департамента на перепланировку/переоборудование арендованного нежилого помещения»', 'Аренда нежилья', 'Земельные и нежилые имущественные вопросы', 'dgi-consult2@mos.ru', 'PostolakiVV@mos.ru', 'Постолаки В.В.',4),
    (1076, 'Онлайн-консультация по вопросам: «Внесение изменений в договор аренды на нежилое помещение,расторжение договора аренды», «Получение согласия Департамента на перепланировку/переоборудование арендованного нежилого помещения»', 'Аренда нежилья', 'Земельные и нежилые имущественные вопросы', 'dgi-consult2@mos.ru', 'PostolakiVV@mos.ru', 'Постолаки В.В.',4),
    (1077, 'Онлайн-консультация по вопросам: «Внесение изменений в договор аренды на нежилое помещение,расторжение договора аренды», «Получение согласия Департамента на перепланировку/переоборудование арендованного нежилого помещения»', 'Аренда нежилья', 'Земельные и нежилые имущественные вопросы', 'dgi-consult2@mos.ru', 'PostolakiVV@mos.ru', 'Постолаки В.В.',4),
    (1078, 'Онлайн-консультация по вопросу: «Внесение изменений в договор аренды земельного участка (если таковые не предусматривают проектирование и строительство), расторжение договора аренды»', 'Изменение аренды земли', 'Земельные и нежилые имущественные вопросы', 'dgi-consult2@mos.ru', 'PostolakiVV@mos.ru', 'Постолаки В.В.',4),
    (1079, 'Онлайн-консультация по вопросу: «Внесение изменений в договор аренды земельного участка (если таковые не предусматривают проектирование и строительство), расторжение договора аренды»', 'Изменение аренды земли', 'Земельные и нежилые имущественные вопросы', 'dgi-consult2@mos.ru', 'PostolakiVV@mos.ru', 'Постолаки В.В.',4),
    (1080, 'Онлайн-консультация по вопросу: «Внесение изменений в договор аренды земельного участка (если таковые не предусматривают проектирование и строительство), расторжение договора аренды»', 'Изменение аренды земли', 'Земельные и нежилые имущественные вопросы', 'dgi-consult2@mos.ru', 'PostolakiVV@mos.ru', 'Постолаки В.В.',4),
    (1081, 'Онлайн-консультация по вопросам: «Предоставление земельного участка в собственность собственникам зданий, строений, сооружений», «Предоставление земельных участков бесплатно в собственность гражданам и юридическим лицам»', 'Предоставление земли', 'Земельные и нежилые имущественные вопросы', 'dgi-consult5@mos.ru', 'MeshkovaEA@mos.ru', 'Мешкова Е.А.',6),
    (1082, 'Онлайн-консультация по вопросам: «Предоставление земельного участка в собственность собственникам зданий, строений, сооружений», «Предоставление земельных участков бесплатно в собственность гражданам и юридическим лицам»', 'Предоставление земли', 'Земельные и нежилые имущественные вопросы', 'dgi-consult5@mos.ru', 'MeshkovaEA@mos.ru', 'Мешкова Е.А.',6),
    (1084, 'Онлайн-консультация по вопросу: «Кадастровый учет и регистрация прав собственности города Москвы (объекты нежилого фонда)»', 'Кадастр на нежильё', 'Земельные и нежилые имущественные вопросы', 'dgi-consult3@mos.ru', 'ProkhorovVD@mos.ru', 'Прохоров В.Д.',8),
    (1085, 'Онлайн-консультация по вопросу: «Кадастровый учет и регистрация прав собственности города Москвы (объекты нежилого фонда)»', 'Кадастр на нежильё', 'Земельные и нежилые имущественные вопросы', 'dgi-consult3@mos.ru', 'ProkhorovVD@mos.ru', 'Прохоров В.Д.',8),
    (1086, 'Онлайн-консультация по вопросу: «Кадастровый учет и регистрация прав собственности города Москвы (объекты нежилого фонда)»', 'Кадастр на нежильё', 'Земельные и нежилые имущественные вопросы', 'dgi-consult3@mos.ru', 'ProkhorovVD@mos.ru', 'Прохоров В.Д.',8),
    (1087, 'Онлайн-консультация по вопросу: «Кадастровый учет и регистрация прав собственности города Москвы (объекты жилого фонда)»', 'Кадастр на жильё', 'Жилищные вопросы', 'dgi-consult3@mos.ru', 'ProkhorovVD@mos.ru', 'Прохоров В.Д.',8),
    (1088, 'Онлайн-консультация по вопросу: «Кадастровый учет и регистрация прав собственности города Москвы (объекты жилого фонда)»', 'Кадастр на жильё', 'Жилищные вопросы', 'dgi-consult3@mos.ru', 'ProkhorovVD@mos.ru', 'Прохоров В.Д.',8),
    (1090, 'Онлайн-консультация по вопросам: «Согласование межевого плана границ земельного участка» и «Кадастровый учет земельных участков, находящихся в собственности города Москвы»', 'Межевой план земли', 'Земельные и нежилые имущественные вопросы', 'dgi-consult3@mos.ru', 'ProkhorovVD@mos.ru', 'Прохоров В.Д.',8),
    (1091, 'Онлайн-консультация по вопросам: «Согласование межевого плана границ земельного участка» и «Кадастровый учет земельных участков, находящихся в собственности города Москвы»', 'Межевой план земли', 'Земельные и нежилые имущественные вопросы', 'dgi-consult3@mos.ru', 'ProkhorovVD@mos.ru', 'Прохоров В.Д.',8),
    (1092, 'Онлайн-консультация по вопросам: «Согласование межевого плана границ земельного участка» и «Кадастровый учет земельных участков, находящихся в собственности города Москвы»', 'Межевой план земли', 'Земельные и нежилые имущественные вопросы', 'dgi-consult3@mos.ru', 'ProkhorovVD@mos.ru', 'Прохоров В.Д.',8),
    (1093, 'Онлайн-консультация по вопросу: «Присвоение, изменение или аннулирование адреса объекта адресации (кроме земельных участков)»', 'Адресация', 'Земельные и нежилые имущественные вопросы', 'dgi-consult3@mos.ru', 'ProkhorovVD@mos.ru', 'Прохоров В.Д.',8),
    (1094, 'Онлайн-консультация по вопросу: «Присвоение, изменение или аннулирование адреса объекта адресации (кроме земельных участков)»', 'Адресация', 'Земельные и нежилые имущественные вопросы', 'dgi-consult3@mos.ru', 'ProkhorovVD@mos.ru', 'Прохоров В.Д.',8),
    (1095, 'Онлайн-консультация по вопросу: «Присвоение, изменение или аннулирование адреса объекта адресации (кроме земельных участков)»', 'Адресация', 'Земельные и нежилые имущественные вопросы', 'dgi-consult3@mos.ru', 'ProkhorovVD@mos.ru', 'Прохоров В.Д.',8),
    (1096, 'Онлайн-консультация по жилищным вопросам: Постановка на жилищный учет', 'Постановка на ЖУ', 'Жилищные вопросы', 'dgi-consult12@mos.ru', 'NaumovOV1@mos.ru', 'Наумов О.В.',1),
    (1097, 'Онлайн-консультация по жилищным вопросам: Очередникам - внесение изменений в учетное дело.', 'Изменение учетных дел', 'Жилищные вопросы', 'dgi-consult12@mos.ru', 'NaumovOV1@mos.ru', 'Наумов О.В.',1),
    (1098, 'Онлайн-консультация по жилищным вопросам: Очередникам - перерегистрация учетного дела.', 'ПРГ', 'Жилищные вопросы', 'dgi-consult12@mos.ru', 'NaumovOV1@mos.ru', 'Наумов О.В.',1),
    (1105, 'Онлайн-консультация по вопросу: «Выкуп свободных комнат в коммунальных квартирах (для граждан, проживающих в квартирах, где есть свободная комната)» ', 'Выкуп комнат', 'Жилищные вопросы', 'dgi-consult5@mos.ru', 'MotsnyyIA@mos.ru', 'Моцный И.А.',6),
    (1129, 'Онлайн-консультация по вопросу: «Изъятие нежилых помещений для государственных нужд, находящихся в частной собственности, расположенных в многоквартирных домах, включенных в программу реновации.»', 'Изъятие нежилья', 'Земельные и нежилые имущественные вопросы', 'dgi-consult4@mos.ru', 'NetkachevaVV@mos.ru', 'Неткачева В.В.',5),
    (1130, 'Онлайн-консультация по вопросу: «Изъятие нежилых помещений для государственных нужд, находящихся в частной собственности, расположенных в многоквартирных домах, включенных в программу реновации.»', 'Изъятие нежилья', 'Земельные и нежилые имущественные вопросы', 'dgi-consult4@mos.ru', 'NetkachevaVV@mos.ru', 'Неткачева В.В.',5),
    (1131, 'Онлайн-консультация по вопросу: «Изъятие нежилых помещений для государственных нужд, находящихся в частной собственности, расположенных в многоквартирных домах, включенных в программу реновации.»', 'Изъятие нежилья', 'Земельные и нежилые имущественные вопросы', 'dgi-consult4@mos.ru', 'NetkachevaVV@mos.ru', 'Неткачева В.В.',5),
    (1190, 'Онлайн-консультация по вопросу: «Сверка расчетов по договорам аренды или купли-продажи объекта недвижимости (нежилого помещения) и земельного участка»', 'Сверка расчётов', 'Земельные и нежилые имущественные вопросы', 'dgi-consult13@mos.ru', 'GalkinaEV4@mos.ru', 'Галкина Е.В.',10),
    (1191, 'Онлайн-консультация по вопросу: «Сверка расчетов по договорам аренды или купли-продажи объекта недвижимости (нежилого помещения) и земельного участка»', 'Сверка расчётов', 'Земельные и нежилые имущественные вопросы', 'dgi-consult13@mos.ru', 'GalkinaEV4@mos.ru', 'Галкина Е.В.',10),
    (1192, 'Онлайн-консультация по вопросу: «Сверка расчетов по договорам аренды или купли-продажи объекта недвижимости (нежилого помещения) и земельного участка»', 'Сверка расчётов', 'Земельные и нежилые имущественные вопросы', 'dgi-consult13@mos.ru', 'GalkinaEV4@mos.ru', 'Галкина Е.В.',10),
    (1446, 'Онлайн-консультация по жилищным вопросам: Очередникам -  предоставление субсидий, жилья бесплатно по ДСН и по льготной стоимости.', 'Предоставление ЖП', 'Жилищные вопросы', 'dgi-consult12@mos.ru', 'NaumovOV1@mos.ru', 'Наумов О.В.',1),
    (1453, 'Онлайн-консультация по жилищным вопросам: Дополнительные разъяснения уведомлений и писем Департамента по жилищным вопросам, не связанным с переселением по Реновации', 'Разъяснения писем', 'Жилищные вопросы', 'dgi-consult12@mos.ru', 'NaumovOV1@mos.ru', 'Наумов О.В.',1),
    (1468, 'Онлайн-консультация по вопросу: «Расчеты по договорам купли-продажи жилых помещений с рассрочкой платежа»', 'Расчёты КПР', 'Жилищные вопросы', 'dgi-consultcpr@mos.ru', 'GalkinaEV4@mos.ru', 'Галкина Е.В.',10),
    (1553, 'Онлайн-консультация по вопросу: Подтверждение добровольного согласия на приватизацию жилого помещения (по округу СВАО)', 'Приватизация (СВАО)', 'Жилищные вопросы', 'dgi-consultSVAO@mos.ru', 'KiryuschenkoEV@mos.ru', 'Кирющенко Е.В.',11),
    (1822, 'Онлайн-консультация по вопросу: Подтверждение добровольного согласия на приватизацию жилого помещения (по округу ЮЗАО)', 'Приватизация (ЮЗАО)', 'Жилищные вопросы', 'dgi-consult14@mos.ru', 'AngaevaMA@mos.ru', 'Ангаева М.А.',12)


-- Клиенты
DROP TABLE IF EXISTS vks.clients CASCADE;
CREATE TABLE vks.clients
(
    id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY,

    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,

    type VARCHAR(50) NOT NULL,
    surname VARCHAR(255),
    first_name VARCHAR(255),
    last_name VARCHAR(255),
    org_name VARCHAR(255),
    snils VARCHAR(14),
    ogrn VARCHAR(255),
    inn VARCHAR(255),

    PRIMARY KEY (id),
);
ALTER TABLE vks.clients
    OWNER to renovation_user;

-- Консультации
DROP TABLE IF EXISTS vks.cases CASCADE;
CREATE TABLE vks.cases
(
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,

    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,

    org TEXT,
    date DATE,
    time TEXT CHECK (time ~ '^\d{2}:\d{2}:\d{2}-\d{2}:\d{2}:\d{2}$'),

    service_id INTEGER REFERENCES vks.services(id) ON DELETE SET NULL,
    -- service_name TEXT,
    status TEXT,

    case_count INTEGER NOT NULL DEFAULT 0,
    booking_id INTEGER,
    booking_date TIMESTAMP WITH TIME ZONE,
    booking_code TEXT NOT NULL,
    booking_source TEXT,
    booking_resource TEXT,

    deputy_fio TEXT,
    phone TEXT,
    email TEXT,

    tiken_num TEXT,
    tiket_call_time TIMESTAMP WITH TIME ZONE,
    tiket_cancel_user_time TIMESTAMP WITH TIME ZONE,
    tiket_cancel_oiv_time TIMESTAMP WITH TIME ZONE,

    problem_audio TEXT,
    problem_video TEXT,
    problem_connection TEXT,
    problem_tech TEXT,
    vks_search_speed TEXT,

    online_grade INTEGER,
    online_grade_comment TEXT,

    operator_link TEXT,
    participant_fio TEXT,
    problem_summary TEXT,
    address TEXT,
    contract_number TEXT,
    letter_number TEXT,
    fls_number TEXT,
    client_id BIGINT REFERENCES vks.clients(id) ON DELETE SET NULL,

    operator_survey_id INTEGER,
    operator_survey_date TIMESTAMP WITH TIME ZONE,
    operator_survey_status VARCHAR(1),
    operator_survey_extralink_id INTEGER,
    operator_survey_extralink_url TEXT,
    operator_survey_fio TEXT,
    operator_survey_consultation_type TEXT,
    operator_survey_is_housing BOOLEAN,
    operator_survey_is_client BOOLEAN,
    operator_survey_address TEXT,
    operator_survey_relation TEXT,
    operator_survey_doc_type TEXT,
    operator_survey_doc_date TEXT,
    operator_survey_doc_num TEXT,
    operator_survey_department TEXT,
    operator_survey_summary TEXT,
    operator_survey_mood TEXT,
    operator_survey_needs_answer BOOLEAN,
    operator_survey_problems TEXT[],
    operator_survey_info_source TEXT,

    client_survey_id INTEGER,
    client_survey_date TIMESTAMP WITH TIME ZONE,
    client_survey_status VARCHAR(1),
    client_survey_extralink_id INTEGER,
    client_survey_extralink_url TEXT,
    client_survey_joined BOOLEAN,
    client_survey_consultation_received BOOLEAN,
    client_survey_grade INTEGER,
    client_survey_comment_positive TEXT,
    client_survey_comment_negative TEXT,

    is_technical BOOLEAN NOT NULL DEFAULT false,

    PRIMARY KEY (id),
    CONSTRAINT unique_booking_code_date UNIQUE (booking_code, date)
);
ALTER TABLE vks.cases
    OWNER to renovation_user;